\documentclass[letterpaper,11pt]{article}

\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage[font=small]{caption}
\usepackage{subcaption}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color}
\lstset{ %
language=Matlab,                    % choose the language of the code
basicstyle=\footnotesize\ttfamily,  % the size of the fonts that are used for the code
numbers=none,                       % where to put the line-numbers
numberstyle=\footnotesize,          % the size of the fonts that are used for the line-numbers
stepnumber=1,                       % the step between two line-numbers. If it is 1 each line will be numbered
numbersep=5pt,                      % how far the line-numbers are from the code
backgroundcolor=\color{white},      % choose the background color. You must add \usepackage{color}
showspaces=false,                   % show spaces adding particular underscores
showstringspaces=false,             % underline spaces within strings
showtabs=false,                     % show tabs within strings adding particular underscores
frame=single,                       % adds a frame around the code
tabsize=2,                          % sets default tabsize to 2 spaces
captionpos=t,                       % sets the caption-position to bottom
breaklines=true,                    % sets automatic line breaking
breakatwhitespace=false,            % sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)},             % if you want to add a comment within your code
xleftmargin=0.5in,
xrightmargin=0.5in,
columns=fullflexible
}

\newtheorem{lemma}{Lemma}

\DeclareMathOperator{\argmin}{arg\,min}
\newcommand{\Tr}{^\text{T}}
\newcommand{\zeros}{\mathbf{0}}
\newcommand{\ones}{\mathbf{1}}
\newcommand{\reals}{\mathbf{R}}
\newcommand{\complexes}{\mathbf{C}}
\newcommand{\MG}[2]{{\text{#1}(#2)}}
\newcommand{\Un}{\MG{U}{n}}
\newcommand{\On}{\MG{O}{n}}
\newcommand{\SUn}{\MG{SU}{n}}
\newcommand{\SOn}{\MG{SO}{n}}
\newcommand{\qr}{\mathbf{qr}}

{
\title{Computing the Homology of Matrix groups}
\author{Xavier Falco, Yuze ``Dan'' Huang, Rafael Witten}
\date{\today}
\begin{document}
\maketitle
\thispagestyle{empty}
%\tableofcontents
%\thispagestyle{empty}
\section{Sampling from $\On$, $\SOn$, $\Un$, and $\SUn$}

\subsection{$\On$ and $\SOn$}
The following matlab code will sample uniformly from $\On$:

\begin{lstlisting}[label=sample_On,caption=Sampling from $\On$]
function [X] = sample_from_O(n)
[X,R] = qr(randn(n));
\end{lstlisting}

In other words, we take the QR decomposition of a matrix whose elements are iid
  normally distributed.
To sample uniformly from $\SOn$, we sample from $\On$, and then
  ``flip'' the determinant if it is not correct:

\begin{lstlisting}[label=sample_SOn,caption=Sampling from $\SOn$]
function [X] = sample_from_SO(n)
X = sample_from_O(n);
if det(X) < 0
  X(1,:) = -X(1,:);
end
\end{lstlisting}

We will prove that these two algorithms sample uniformly (in the Haar sense)
  from their respective spaces.

\begin{lemma}
Listing~\ref{sample_On} will sample uniformly from $\On$, i.e. if $X$
  is the output of listing~\ref{sample_On}, then for any set $S\subset
  \reals^{n\times n}$, $\Pr(X\in S) = \Pr(X\in USV)$ for all $U,V \in \On$.

\begin{proof}
Let $M$ be a random $n\times n$ matrix where the entries $s_{ij}$ are all iid
  normally distributed.
Let $\qr:\reals^{n\times n} \to \On$ be the ``Q'' in the QR decomposition
  of a matrix.
\begin{align}
\Pr\left(U\qr(M)V\in S\right) &= \Pr\left(\qr(UM)V \in S\right)\\
  &= \Pr\left(\qr(M)V \in S             \right)\\
  &= \Pr\left( (V\Tr\qr(M)\Tr)\Tr \in S \right)\\
  &= \Pr\left( (V\Tr\qr(M))\Tr \in S    \right)\\
  &= \Pr\left((\qr(M))\Tr \in S         \right)\\
  &= \Pr\left(\qr(M) \in S              \right)
\end{align}
\end{proof}
\end{lemma}

\begin{lemma}
Listing~\ref{sample_SOn} induces the Haar measure on $\SOn$.

\begin{proof}
Define the matrix
\[
  C = \begin{bmatrix}-1 & \zeros\Tr\\ \zeros & I_{n-1} \end{bmatrix}.
\]

Define $f:\On\to\SOn$ with
\[
  f(X) = \left\{
\begin{array}{ll}
  X & \mbox{if }\det{X} = 1\\
 XC & \mbox{if }\det{X} = -1
\end{array}\right.
\]
It is clear that listing~\ref{sample_SOn} will sample a matrix $M$ from $\On$,
  and return $f(M)$.

If we let $S \subset \SOn$, then
\begin{align}\label{SOn:uso}
  \Pr\left(f(M) \in S\right)
  &=\Pr\left(M \in S \right) + \Pr\left( MC \in S \right) \\
  &=2\Pr\left(M \in S \right)
\end{align}
because $C$ is orthogonal, and because of the rotational invariance of
  listing~\ref{sample_On}.

Let $\mu_\On$ and $\mu_\SOn$ be the measures induced by
  listings~\ref{sample_On} and \ref{sample_SOn}, respectively.
We showed in (\ref{SOn:uso}) that $\mu_\SOn(S) = 2\mu_\On(S\cap \SOn)$ for
  $S\subset\On$.
Let $S \subset \SOn$, and let $U,V \in \SOn$.
To show that listing~\ref{sample_SOn} induces Haar measure, we note
\begin{align}
  \mu_\SOn(USV) &= 2 \mu_\On(U(S\cap\SOn)V)\\
  &= 2 \mu_\On(USV \cap U\SOn V)\\
  &= 2 \mu_\On(S \cap \SOn)\\
  &= \mu_\SOn(S).
\end{align}
\end{proof}
\end{lemma}

\subsection{$\Un$ and $\SUn$}

For $\Un$, we have the same idea: generate a random complex matrix, and then
  orthogonalize it.
There is one small issue: without forcing constraints on the diagonal of the
  matrix $R$ in the QR decomposition $M=QR$, this decomposition is actually
  {\bf not} unique.
This is important, because some implementations of $\qr$ will not induce
  the Haar measure on $\Un$.
However, if we constrain the diagonal of $R$ to have strictly positive (real)
  entries, then the induced measure will be Haar.

A proof that the measure induced by listing~\ref{sample_Un} is the Haar
  measure on $\Un$, meaning this sampling method uniformly samples from $\Un$,
  is provided in \cite{Mezzadri2007}.

\begin{lstlisting}[label=sample_Un,caption=Sampling from $\Un$]
function [Q] = qr_pos(M)
[Q,R] = qr(M);
Q = Q * diag(sign(diag(R)));
end

function [X] = sample_from_U(n)
X = qr_pos(randn(n) + 1i * randn(n));
end
\end{lstlisting}

To sample uniformly from $\SUn$, we simply force the determinant of the
  output of listing~\ref{sample_Un} to be 1:

\begin{lstlisting}[label=sample_SUn,caption=Sampling from $\SUn$]
function [X] = sample_from_SU(n)
X = sample_from_U(n);
X = X / (det(X)^(1/n));
\end{lstlisting}

\begin{lemma}
Listing~\ref{sample_SUn} induces the Haar measure on $\SUn$.

\begin{proof}
Define $f:\Un\to\SUn$ with $f(X) = (\det X)^{-\frac{1}{n}}X$.
We can also write $f(X) = XC((\det X)^{-\frac{1}{n}})$, where $C(x)=xI_n$.
Notice that $C(x)$ commutes with $n\times n$ matrices for every $x$.
It is clear that listing~\ref{sample_SUn} will sample a matrix $M$ from $\Un$,
  and return $f(M)$.
In other words, if $\mu_\Un$ and $\mu_\SUn$ be the measures induced by
  listings~\ref{sample_Un} and \ref{sample_SUn}, respectively, then
  $\mu_\SUn(S) = \mu_\Un(S)$ for all $S\subset\SUn$.

Let $S\subset \SUn$, and $U,V\in \SUn$.
To show that $\mu_\SUn$ is Haar measure, we see that
\begin{align}
  \mu_\SUn\left(USV\right)  &= \mu_\Un\left(f^{-1}(USV)\right) \\
                            &= \mu_\Un\left(Uf^{-1}(S)V\right) \\
                            &= \mu_\Un\left(f^{-1}(S)\right) \\
                            &= \mu_\SUn\left(S\right).
\end{align}
\end{proof}
\end{lemma}

\thispagestyle{empty}
\bibliographystyle{abbrv}
\bibliography{writeup}

\end{document}
}

